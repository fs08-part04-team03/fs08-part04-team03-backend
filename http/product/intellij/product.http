@baseUrl = http://localhost:4000
@apiVersion = v1
@categoryId = 101

### 로그인 (manager)
# @name login
POST {{baseUrl}}/api/{{apiVersion}}/auth/login
Content-Type: application/json

{
  "email": "manager@test.com",
  "password": "testM1234!"
}

> {%
  client.global.set("token", response.body.data.accessToken);
%}

### product 필수값 누락 (400)
POST {{baseUrl}}/api/{{apiVersion}}/product
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "HTTP_TEST_MISSING_FIELDS"
}

### product 잘못된 카테고리 (404)
POST {{baseUrl}}/api/{{apiVersion}}/product
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "categoryId": 999999,
  "name": "HTTP_TEST_INVALID_CATEGORY",
  "price": 1000,
  "link": "https://example.com/products/http-test-invalid"
}

### product A 생성 (이미지 없음) (201)
# @name createProductA
POST {{baseUrl}}/api/{{apiVersion}}/product
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=WebKitFormBoundary

--WebKitFormBoundary
Content-Disposition: form-data; name="categoryId"

{{categoryId}}
--WebKitFormBoundary
Content-Disposition: form-data; name="name"

버터링
--WebKitFormBoundary
Content-Disposition: form-data; name="price"

2500
--WebKitFormBoundary
Content-Disposition: form-data; name="link"

https://example.com/products/http-test-a
--WebKitFormBoundary--

> {%
  // 생성된 productA id 저장
  client.global.set("productAId", response.body.data.id);
%}

### product B 생성 (이미지 포함) (201)
# @name createProductB
# 참고: 실제 이미지 파일을 업로드하려면 아래와 같이 < 연산자를 사용하세요
POST {{baseUrl}}/api/{{apiVersion}}/product
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=WebKitFormBoundary

--WebKitFormBoundary
Content-Disposition: form-data; name="categoryId"

{{categoryId}}
--WebKitFormBoundary
Content-Disposition: form-data; name="name"

알새우칩
--WebKitFormBoundary
Content-Disposition: form-data; name="price"

1800
--WebKitFormBoundary
Content-Disposition: form-data; name="link"

https://example.com/products/http-test-b
--WebKitFormBoundary
Content-Disposition: form-data; name="image"; filename="test.jpg"
Content-Type: image/jpeg

< ./test.jpg
--WebKitFormBoundary--

> {%
  // 생성된 productB id 저장
  client.global.set("productBId", response.body.data.id);
%}

### productA detail 조회 (default) (200)
GET {{baseUrl}}/api/{{apiVersion}}/product/{{productAId}}
Authorization: Bearer {{token}}

### product detail 조회 - 존재하지 않는 상품 (404)
GET {{baseUrl}}/api/{{apiVersion}}/product/99999999
Authorization: Bearer {{token}}

### product 리스트 최신순 조회 (카테고리) (200)
GET {{baseUrl}}/api/{{apiVersion}}/product?categoryId={{categoryId}}&sort=latest&limit=100
Authorization: Bearer {{token}}

### product 리스트 가격 오름차순 조회 (200)
GET {{baseUrl}}/api/{{apiVersion}}/product?categoryId={{categoryId}}&sort=priceAsc&limit=20
Authorization: Bearer {{token}}

### product 리스트 가격 내림차순 조회 (200)
GET {{baseUrl}}/api/{{apiVersion}}/product?categoryId={{categoryId}}&sort=priceDesc&limit=20
Authorization: Bearer {{token}}

### product 리스트 잘못된 정렬값 (검증) 조회 (400)
GET {{baseUrl}}/api/{{apiVersion}}/product?sort=unknown
Authorization: Bearer {{token}}

### 구매 즉시 판매량 생성 (200)
# @name purchaseNow
POST {{baseUrl}}/api/{{apiVersion}}/purchase/admin/purchaseNow
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "shippingFee": 0,
  "items": [
    { "productId": {{productAId}}, "quantity": 5 },
    { "productId": {{productBId}}, "quantity": 2 }
  ]
}

### product 리스트 판매량 순 조회 (200)
GET {{baseUrl}}/api/{{apiVersion}}/product?categoryId={{categoryId}}&sort=sales&limit=100
Authorization: Bearer {{token}}

### product 수정 - 필드만 수정 (MANAGER 이상) (200)
PATCH {{baseUrl}}/api/{{apiVersion}}/product/{{productBId}}
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=WebKitFormBoundary

--WebKitFormBoundary
Content-Disposition: form-data; name="name"

알새우칩_수정본
--WebKitFormBoundary
Content-Disposition: form-data; name="price"

3456
--WebKitFormBoundary--

### product 수정 - 이미지 추가/교체 (MANAGER 이상) (200)
PATCH {{baseUrl}}/api/{{apiVersion}}/product/{{productBId}}
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=WebKitFormBoundary

--WebKitFormBoundary
Content-Disposition: form-data; name="name"

알새우칩_이미지추가
--WebKitFormBoundary
Content-Disposition: form-data; name="image"; filename="updated.jpg"
Content-Type: image/jpeg

< ./test-images/updated.jpg
--WebKitFormBoundary--

### product 수정 - 이미지 제거 (MANAGER 이상) (200)
PATCH {{baseUrl}}/api/{{apiVersion}}/product/{{productBId}}?removeImage=true
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=WebKitFormBoundary

--WebKitFormBoundary
Content-Disposition: form-data; name="name"

알새우칩_이미지제거
--WebKitFormBoundary--

### product 삭제 (MANAGER 이상) (200)
DELETE {{baseUrl}}/api/{{apiVersion}}/product/{{productAId}}
Authorization: Bearer {{token}}

### 삭제된 productA detail 조회 (404)
GET {{baseUrl}}/api/{{apiVersion}}/product/{{productAId}}
Authorization: Bearer {{token}}

### 삭제된 productA가 목록에서 안 나오는지 확인 (200)
GET {{baseUrl}}/api/{{apiVersion}}/product?categoryId={{categoryId}}&sort=latest&limit=100
Authorization: Bearer {{token}}
